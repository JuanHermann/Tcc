<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="#{layoutMB.template}">



	<ui:define name="title">
        Meus Agendamentos
    </ui:define>
	<ui:define name="description">
        Aqui você pode ver seus agendamentos e agendar novos horarios.
    </ui:define>

	<ui:define name="head-end">
		<ui:param name="renderBreadCrumb" value="false" />
	</ui:define>

	<ui:define name="body">
		<f:metadata>
			<f:viewParam name="id" value="#{usuarioLogadoBean.usuario.id}" />
			<f:viewAction action="#{indexClienteBean.init}" />
		</f:metadata>


		<h:form id="form" prependId="false">


			<div class="box box-primary">
				<div class="box-header with-border">


					<div class="ui-g ui-fluid">
						<div class="ui-sm-12 ui-md-4 ui-lg-6">
							<p:commandButton id="agendar" value="Agendar Novo Horario"
								onclick="PF('inserir').show();" type="button"
								icon="fa fa-plus-square-o" styleClass="btn-info" />

						</div>

					</div>
					<div class="ui-g ui-fluid">
						<div class="ui-sm-12 ui-md-4 ui-lg-1"></div>
						<div class="ui-sm-12 ui-md-4 ui-lg-4">
							<p:separator />
						</div>

					</div>

					<div class="ui-g ui-fluid">
						<div class="ui-sm-12 ui-md-4 ui-lg-6">
							<p:dataList value="#{indexClienteBean.horariosCliente}"
								var="horario" type="definition">
								
								<p:panel id="panel-#{horario.id}" header="#{horario.data} - #{horario.horaInicio} - #{horario.usuarioServico.servico.nome}" toggleable="true"
									toggleSpeed="500" widgetVar="panel" style="margin-bottom:20px" collapsed="true">

									<h:panelGrid columns="2" cellpadding="10">
										<h:outputText value="#{horario.data}" />
									</h:panelGrid>

								</p:panel>
							</p:dataList>
						</div>

					</div>




					<p:growl id="growl" sticky="true" showDetail="true" life="3000" />

					<p:dialog id="dialogAgendar" widgetVar="inserir"
						header="Cadastrar Horario" showEffect="clip" hideEffect="clip">

						<h:panelGrid id="eventDetails" columns="1">
							<p:outputPanel id="idGeral">
								<h:panelGrid columns="1">



									<p:outputLabel for="servico" value="Serviço:" id="olServico" />

									<p:selectCheckboxMenu id="servico"
										value="#{indexClienteBean.servicosSelecionados}"
										label="Serviços" multiple="true" filter="true"
										filterMatchMode="startsWith" required="true"
										requiredMessage="Selecione um serviço"
										panelStyle="width:250px">
										<f:selectItems value="#{indexClienteBean.servicos}"
											var="servico" itemLabel="#{servico.nome}"
											itemValue="#{servico}" />
										<p:ajax event="change" update="funcionario horario"
											render="@this olServico"
											listener="#{indexClienteBean.buscarFuncionarios()}" />

									</p:selectCheckboxMenu>


									<p:outputPanel
										rendered="#{indexClienteBean.mostrarFuncionario()}">
										<p:outputLabel for="funcionario" value="Funcionario:" />

										<p:selectOneMenu id="funcionario"
											value="#{indexClienteBean.funcionario}"
											converter="#{usuarioConverter}">
											<f:selectItem itemLabel="Nenhuma Preferencia"
												itemValue="#{null}" />
											<f:selectItems value="#{indexClienteBean.setFuncionarios}"
												var="funcionario" itemLabel="#{funcionario.nome}"
												itemValue="#{usuario}" />
										</p:selectOneMenu>
									</p:outputPanel>

									<p:outputLabel for="data" value="Dia:" />

									<p:calendar id="data" value="#{indexClienteBean.objeto.data}"
										required="true" requiredMessage="Selecione um dia"
										mindate="#{indexClienteBean.dataMinima}" pattern="dd/MM/yyyy"
										converter="#{localDateConverter}">
										<p:ajax event="dateSelect"
											listener="#{indexClienteBean.buscarHorarios}"
											update="horario" />
									</p:calendar>

									<p:outputLabel value="Horario:" for="horario" id="olHorario" />

									<p:selectOneMenu id="horario" converter="#{localTimeConverter}"
										required="true" requiredMessage="Selecione um horario"
										value="#{indexClienteBean.objeto.horaInicio}">
										<f:selectItem itemLabel="#{indexClienteBean.stringHorario}"
											itemValue="" />
										<f:selectItems value="#{indexClienteBean.horarios}"
											var="horario" itemLabel="#{horario}" itemValue="#{localTime}" />

										<f:ajax event="change" render="@this olHorario" />
									</p:selectOneMenu>
								</h:panelGrid>
								<p:commandButton value="Salvar"
									action="#{indexClienteBean.salvarAgendamento()}"
									update="growl eventDetails" icon="fa fa-check"
									oncomplete="if(args.sucesso == true) { PF('inserir').hide(); }" />

							</p:outputPanel>

						</h:panelGrid>

					</p:dialog>



				</div>

			</div>

		</h:form>

	</ui:define>

</ui:composition>
